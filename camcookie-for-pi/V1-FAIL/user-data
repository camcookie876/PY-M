#cloud-config
manage_resolv_conf: false
hostname: Camcookie-1
manage_etc_hosts: true
packages:
- avahi-daemon
apt:
  preserve_sources_list: true
  conf: |
    Acquire {
      Check-Date "false";
    };
timezone: America/New_York
keyboard:
  model: pc105
  layout: "us"
users:
- name: camcookie1
  groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo
  shell: /bin/bash
  lock_passwd: false
  passwd: "$y$jB5$jZrJsZbMDZnRrdYMfBKCq.$K0Q9QTG6bfT6dRLd39k5hgWQoUATDJzur3pF1IFuYz5"
enable_ssh: true
ssh_pwauth: true
rpi:
  interfaces:
    serial: true
runcmd:
  - [ sh, -c, "install -o camcookie1 -m 700 -d /home/camcookie1/.config/com.raspberrypi.connect" ]
  - [ sh, -c, "printf '%s\n' 'rpuak_3iNyU8RmgkUZPpbuybsdgUpB' > /home/camcookie1/.config/com.raspberrypi.connect/auth.key && chown camcookie1:camcookie1 /home/camcookie1/.config/com.raspberrypi.connect/auth.key && chmod 600 /home/camcookie1/.config/com.raspberrypi.connect/auth.key" ]
  - [ sh, -c, "install -o camcookie1 -m 700 -d /home/camcookie1/.config/systemd/user/default.target.wants /home/camcookie1/.config/systemd/user/paths.target.wants" ]
  - [ sh, -c, "UNIT_SRC=/usr/lib/systemd/user/rpi-connect.service; [ -f $UNIT_SRC ] || UNIT_SRC=/lib/systemd/user/rpi-connect.service; ln -sf $UNIT_SRC /home/camcookie1/.config/systemd/user/default.target.wants/rpi-connect.service" ]
  - [ sh, -c, "UNIT_SRC=/usr/lib/systemd/user/rpi-connect-signin.path; [ -f $UNIT_SRC ] || UNIT_SRC=/lib/systemd/user/rpi-connect-signin.path; ln -sf $UNIT_SRC /home/camcookie1/.config/systemd/user/paths.target.wants/rpi-connect-signin.path" ]
  - [ sh, -c, "UNIT_SRC=/usr/lib/systemd/user/rpi-connect-wayvnc.service; [ -f $UNIT_SRC ] || UNIT_SRC=/lib/systemd/user/rpi-connect-wayvnc.service; ln -sf $UNIT_SRC /home/camcookie1/.config/systemd/user/default.target.wants/rpi-connect-wayvnc.service" ]
  - [ sh, -c, "chown -R camcookie1:camcookie1 /home/camcookie1/.config/systemd" ]
  - [ sh, -c, "install -d -m 0755 /var/lib/systemd/linger" ]
  - [ sh, -c, "install -m 0644 /dev/null /var/lib/systemd/linger/camcookie1" ]
  - [ sh, -c, "loginctl enable-linger camcookie1 2>/dev/null || true" ]
  - [ sleep, "2" ]
  - [ sh, -c, "systemctl --quiet --user --machine=camcookie1@.host daemon-reload || true" ]
  - [ sh, -c, "systemctl --quiet --user --machine=camcookie1@.host start rpi-connect.service || true" ]
  - [ sh, -c, "systemctl --quiet --user --machine=camcookie1@.host start rpi-connect-signin.path || true" ]
  - [ sh, -c, "systemctl --quiet --user --machine=camcookie1@.host start rpi-connect-wayvnc.service || true" ]
